<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>For My Rib ‚Äî A Little Flower</title>
  <style>
    :root{
      --bg:#0f172a;
      --card:#0b1220;
      --accent:#ff6b6b;
      --muted:#9aa4b2;
      --petal1:#ff8aa8;
      --petal2:#ff5d87;
      --center:#ffd166;
      --glass: rgba(255,255,255,0.04);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255,120,140,0.06), transparent),
                  radial-gradient(900px 500px at 90% 90%, rgba(40,120,255,0.03), transparent),
                  var(--bg);
      color: #e6eef8;
      -webkit-font-smoothing:antialiased;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      gap:20px;
      flex-direction:column;
    }

    .card{
      width:min(920px,96vw);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:18px;
      padding:28px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      display:grid;
      grid-template-columns: 430px 1fr;
      gap:20px;
      align-items:center;
      overflow:hidden;
    }

    /* Left: flower area */
    .flower-area{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      padding:12px;
    }
    .flower-wrap{
      width:360px;
      height:360px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      touch-action:manipulation;
      cursor:pointer;
    }

    /* SVG flower base */
    svg.flower{
      width:320px;
      height:320px;
      display:block;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,0.45));
      transition: transform .45s cubic-bezier(.2,.9,.2,1);
      transform-origin:center;
    }

    /* pulse when open */
    .flower-open svg.flower{ transform: scale(1.02) rotate(-2deg); }

    /* center */
    .center{
      transform-origin:center;
      transition: transform .35s ease;
    }
    .flower-open .center{ transform: scale(1.05); }

    /* petal animation (subtle float) */
    .petal{
      transform-origin: 50% 60%;
      transition: transform .45s cubic-bezier(.2,.9,.2,1);
    }
    .flower-open .petal{ transform: translateY(-6px) scale(1.03); }

    /* falling petals container */
    .petal-fall{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
    }
    .petal-item{
      position:absolute;
      width:18px;
      height:28px;
      opacity:0;
      transform-origin:center;
      will-change:transform,opacity;
      animation: none;
    }
    @keyframes fall {
      0% { transform: translateY(-20vh) rotate(0deg) scale(0.9); opacity:0; }
      10% { opacity:1; }
      100% { transform: translateY(120vh) rotate(540deg) scale(0.6); opacity:0; }
    }

    /* Right: message area */
    .msg-area{
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    h1{
      margin:0;
      font-size:20px;
      letter-spacing:0.2px;
      color:#fff;
    }
    .subtitle{ color:var(--muted); font-size:13px; margin-top:2px; }

    .message{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:14px;
      min-height:120px;
      font-size:16px;
      line-height:1.45;
      color:#eaf3ff;
      white-space:pre-wrap;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      margin-top:8px;
      flex-wrap:wrap;
    }

    .btn{
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.04);
      color:inherit;
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      font-size:14px;
      display:inline-flex;
      gap:8px;
      align-items:center;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(90deg,var(--accent), #ff5477);
      color:#081022;
      border:none;
      box-shadow: 0 6px 18px rgba(255,80,120,0.12);
    }

    .small{ font-size:13px; color:var(--muted) }

    .file-input{ display:none; }

    .footer{
      margin-top:10px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:center;
      color:var(--muted);
      font-size:13px;
    }

    @media (max-width:880px){
      .card{ grid-template-columns: 1fr; padding:18px; }
      .flower-wrap{ width:260px; height:260px }
      svg.flower{ width:240px; height:240px }
    }
  </style>
</head>
<body>
  <div class="card" id="cardRoot">
    <div class="flower-area">
      <div class="flower-wrap" id="flowerWrap" title="Klik untuk membuka/menutup">
        <!-- Flower SVG: 8 petals -->
        <svg class="flower" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <g transform="translate(100,100)">
            <!-- petals -->
            <g class="petals">
              <!-- we'll create petals by repeating rotated petal shapes -->
              <g transform="rotate(0)" class="petal" id="petal-0">
                <path d="M0,-6 C20,-40 40,-40 50,-6 C40,14 20,28 0,30 C-20,28 -40,14 -50,-6 C-40,-40 -20,-40 0,-6 Z"
                      fill="url(#g1)"/>
              </g>
              <g transform="rotate(45)" class="petal" id="petal-1">
                <use href="#petal-0" />
              </g>
              <g transform="rotate(90)" class="petal" id="petal-2">
                <use href="#petal-0" />
              </g>
              <g transform="rotate(135)" class="petal" id="petal-3">
                <use href="#petal-0" />
              </g>
              <g transform="rotate(180)" class="petal" id="petal-4">
                <use href="#petal-0" />
              </g>
              <g transform="rotate(225)" class="petal" id="petal-5">
                <use href="#petal-0" />
              </g>
              <g transform="rotate(270)" class="petal" id="petal-6">
                <use href="#petal-0" />
              </g>
              <g transform="rotate(315)" class="petal" id="petal-7">
                <use href="#petal-0" />
              </g>
            </g>

            <!-- center circle -->
            <circle class="center" r="20" fill="url(#centerGrad)" />
          </g>

          <!-- gradients -->
          <defs>
            <linearGradient id="g1" x1="0" x2="1">
              <stop offset="0" stop-color="#ff9eb3"/>
              <stop offset="1" stop-color="#ff5d87"/>
            </linearGradient>
            <radialGradient id="centerGrad">
              <stop offset="0" stop-color="#fff6d0"/>
              <stop offset="1" stop-color="#ffd166"/>
            </radialGradient>
          </defs>
        </svg>

        <div class="petal-fall" id="petalFall" aria-hidden="true"></div>
      </div>

      <div class="small">Klik bunga untuk mekarkan / turunkan kelopak. Klik lagi untuk melempar beberapa kelopak.</div>
    </div>

    <div class="msg-area">
      <div>
        <h1>For my rib</h1>
        <div class="subtitle">Sebuah ucapan kecil ‚Äî edit teks di bawah sesuai keinginanmu.</div>
      </div>

      <div id="message" class="message" contenteditable="false" aria-label="Ucapan">
Good night and selamat bobo, sayang.üò™üåÉ
Aku tahu tugas bikin bete ‚Äî tapi kamu udah lakukan yang terbaik.
Besok pasti lebih baik. Aku bangga banget sama kamu.
I love you the most. ‚ù§Ô∏è
      </div>

      <div class="controls">
        <button class="btn primary" id="toggleOpen">Buka / Tutup Bunga</button>
        <label for="audioFile" class="btn" title="Pilih file audio .mp3 (opsional)">Pilih Musik
          <input type="file" id="audioFile" accept="audio/*" class="file-input">
        </label>
        <button class="btn" id="playBtn">Play / Pause</button>
        <button class="btn" id="editBtn" title="Edit pesan">Edit Pesan</button>
        <button class="btn" id="downloadBtn" title="Simpan halaman">Simpan HTML</button>
      </div>

      <div class="footer">
        <div class="small">Tip: letakkan file musik di folder yang sama dan pilih dari tombol "Pilih Musik".</div>
        <div class="small">No watermark ‚Äî bebas pakai.</div>
      </div>
    </div>
  </div>

  <audio id="audioPlayer" preload="none"></audio>

  <script>
    // ---------- Configurable content ----------
    // Jika ingin ubah pesan lewat kode: ubah isi messageText.
    const messageText = `Good night and selamat bobo, sayang.üò™üåÉ
Aku tahu tugas bikin bete ‚Äî tapi kamu udah lakukan yang terbaik.
Besok pasti lebih baik. Aku bangga banget sama kamu.
I love you the most. ‚ù§Ô∏è`;

    // ---------- Elements ----------
    const root = document.getElementById('cardRoot');
    const flowerWrap = document.getElementById('flowerWrap');
    const toggleOpen = document.getElementById('toggleOpen');
    const messageEl = document.getElementById('message');
    const petalFall = document.getElementById('petalFall');
    const audioInput = document.getElementById('audioFile');
    const audioPlayer = document.getElementById('audioPlayer');
    const playBtn = document.getElementById('playBtn');
    const editBtn = document.getElementById('editBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    // set initial text
    messageEl.textContent = messageText;

    // toggle flower open/close
    let open = false;
    function setOpen(state){
      open = !!state;
      if(open) root.classList.add('flower-open');
      else root.classList.remove('flower-open');
    }

    toggleOpen.addEventListener('click', () => {
      setOpen(!open);
      if(open) emitPetals(7);
    });

    flowerWrap.addEventListener('click', () => {
      setOpen(!open);
      if(open) emitPetals(10);
    });

    // Emit falling petals
    function emitPetals(count=8){
      for(let i=0;i<count;i++){
        createPetal();
      }
    }

    function rand(min,max){ return Math.random()*(max-min)+min; }

    function createPetal(){
      const p = document.createElement('div');
      p.className = 'petal-item';
      // small SVG inside
      p.innerHTML = `<svg viewBox="0 0 20 30" width="20" height="30" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M10 0 C16 6 18 12 10 30 C2 12 4 6 10 0 Z" fill="${randColor()}" opacity="${rand(0.9,1)}"/>
      </svg>`;
      // start x position near center +/- 120px
      const startX = 140 + rand(-120,120);
      p.style.left = `${startX}px`;
      p.style.top = `${rand(20,80)}px`;
      // random animation duration and delay
      const dur = rand(3.6,6.2).toFixed(2) + 's';
      const delay = rand(0,0.6).toFixed(2) + 's';
      p.style.animation = `fall ${dur} linear ${delay} forwards`;
      p.style.opacity = 0;
      petalFall.appendChild(p);
      // cleanup after animation
      setTimeout(()=> {
        p.remove();
      }, (parseFloat(dur)+parseFloat(delay))*1000 + 300);
    }

    function randColor(){
      // pick between two petal tones
      return Math.random() > 0.5 ? '#ff8aa8' : '#ff5d87';
    }

    // Audio control: allow user to pick a file
    audioInput.addEventListener('change', (e)=>{
      const file = e.target.files && e.target.files[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      audioPlayer.src = url;
      audioPlayer.loop = true;
      audioPlayer.play().catch(()=>{ /* ignore autoplay restrictions */ });
      playBtn.textContent = 'Pause';
    });

    playBtn.addEventListener('click', ()=>{
      if(!audioPlayer.src){
        // no audio selected -> give small feedback
        alert('Pilih file musik terlebih dahulu (atau letakkan musik.mp3 di folder dan pilih).');
        return;
      }
      if(audioPlayer.paused){
        audioPlayer.play();
        playBtn.textContent = 'Pause';
      } else {
        audioPlayer.pause();
        playBtn.textContent = 'Play';
      }
    });

    // Edit message in-place
    let editing = false;
    editBtn.addEventListener('click', ()=>{
      editing = !editing;
      messageEl.contentEditable = editing ? "true" : "false";
      messageEl.focus();
      editBtn.textContent = editing ? 'Simpan' : 'Edit Pesan';
      if(!editing){
        // saved
      }
    });

    // Download the current HTML (self-contained)
    downloadBtn.addEventListener('click', ()=>{
      const exporter = `data:text/html;charset=utf-8,${encodeURIComponent(document.documentElement.outerHTML)}`;
      const a = document.createElement('a');
      a.href = exporter;
      a.download = 'for_my_rib.html';
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    // Accessibility: allow keyboard toggle (Enter / Space) on flower wrap
    flowerWrap.setAttribute('tabindex','0');
    flowerWrap.addEventListener('keydown', (ev)=>{
      if(ev.key === 'Enter' || ev.key === ' '){
        ev.preventDefault();
        flowerWrap.click();
      }
    });

    // small initial gentle petal burst
    setTimeout(()=> emitPetals(6), 800);

    // Prevent accidental text selection on double click of flower area
    flowerWrap.addEventListener('mousedown', (e)=> e.preventDefault());
  </script>
</body>
</html>

